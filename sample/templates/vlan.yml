name: Vlan 
description: Firt template set - Create VLAN on Access Ports
template-version: 1.0
software-type: Nuage Networks VSD
software-version: 5.2.2
variables:
  - name: gateway
    type: reference
  - name: port_name
    type: reference
  - name: access_vlan_number
    type: integer
  - name: description
    type: string
    optional: True
  - name: enterprise_name
    type: reference
    optional: True
    
actions:
{% if enterprise_name is defined %}
  - select-object:
      type: enterprise
      by-field: name
      value: {{ enterprise_name }}
      actions:
      - store-value:
          as-name: enterprise_id
          from-field: id
{% endif %}
  - select-object:
      type: gateway
      by-field: name
      value: {{ gateway }}
      actions: 
        - select-object: 
            type: port
            by-field: name
            value: {{ port_name }}
            actions: 
              - create-object:
                  type: vlan
                  select-by-field: value
                  actions:
                    - set-values:
                        value: {{ access_vlan_number }}
                        description: {{ description | default("")}}
                    - store-value:
                        as-name: vlan_template_id
                        from-field: id
                    {% if enterprise_name is defined %}
                    - create-object: 
                        type: enterprisepermission
                        actions:
                          - set-values: 
                              name: {{ enterprise_name }}
                              permittedEntityName: {{ enterprise_name }}
                              permittedAction: USE
                              permittedEntityDescription: {{ description | default("") }}
                          - retrieve-value:
                              from-name: enterprise_id
                              to-field: permittedEntityID
                     {% endif %}
name: Enterprise Permission
description: First template set - Create an Enterprise Permission
template-version: 1.0
software-type: Nuage Networks VSD
software-version: 5.2.2
variables:
  - name: permision_enterprise_name
    type: reference
  - name: gateway
    type: reference
  - name: port_name
    type: reference
    optional: true
  - name: access_vlan_number
    type: integer
    optional: true
  - name: permitted_action
    type: choice
    choices:
      - all
      - deploy
      - extend
      - instantiate
      - read
      - use
    optional: True
  - name: description
    type: string
    optional: True

actions:
  - select-object:
      type: Enterprise
      by-field: name
      value: {{ permision_enterprise_name }}
      actions:
      - store-value:
          as-name: enterprise_id
          from-field: id
  - select-object:
      type: Gateway
      by-field: name
      value: {{ gateway }}
      actions:
        {% if port_name is defined %}
        - select-object:
            type: Port
            by-field: name
            value: {{ port_name }}
            actions:
              {% if access_vlan_number is defined %}
              - select-object:
                  type: Vlan
                  by-field: value
                  value: {{ access_vlan_number }}
                  actions:
              {% endif %}
        {% endif %}
                    - create-object:
                        type: EnterprisePermission
                        actions:
                          - set-values:
                              permittedEntityName: {{ permision_enterprise_name }}
                              permittedAction: {{ permitted_action| default("use") | upper }}
                              permittedEntityDescription: {{ description | default("") }}
                          - retrieve-value:
                              from-name: enterprise_id
                              to-field: permittedEntityID

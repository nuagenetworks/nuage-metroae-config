name: Bidirectional Security Policy
description: First template set - Create a Bidirectional Security Policy on a Domain
template-version: 1.0
software-type: Nuage Networks VSD
software-version: 5.0.2
variables:
  - name: enterprise_name
    type: reference
  - name: domain_name
    type: reference
  - name: security_policy_name
    type: string
  - name: description
    type: string
    optional: true
  - name: default_allow_ip
    type: boolean
  - name: default_allow_non_ip
    type: boolean
  - name: policy_priority
    type: integer
  - name: allow_address_spoof
    type: boolean
  - name: default_install_acl_implicit_rules
    type: boolean
  - name: active
    type: boolean
    optional: true

actions:
  - select-object:
      type: Enterprise
      by-field: name
      value: {{ enterprise_name }}
      actions:
        - select-object:
            type: Domain
            by-field: name
            value: {{ domain_name }}
            actions:
              - create-object:
                  type: IngressACLTemplate
                  actions:
                    - set-values:
                        name: {{ security_policy_name }}
                        description: {{ description | default("Ingress ACL template " + security_policy_name | default("")) }}
                        defaultAllowIP: {{ default_allow_ip }}
                        defaultAllowNonIP: {{ default_allow_non_ip }}
                        priority: {{ policy_priority }}
                        allowAddressSpoof: {{ allow_address_spoof }}
                        active: {{ active | default(True) }}
                    
              - create-object:
                  type: EgressACLTemplate
                  actions:
                    - set-values:
                        name: {{ security_policy_name }}
                        description: {{ description | default("Egress ACL template " + security_policy_name | default("")) }}
                        defaultAllowIP: {{ default_allow_ip }}
                        defaultAllowNonIP: {{ default_allow_non_ip }}
                        priority: {{ policy_priority }}
                        defaultInstallACLImplicitRules: {{ default_install_acl_implicit_rules }}
                        active: {{ active | default(True) }}
                    
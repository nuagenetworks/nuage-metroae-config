name: InfrastructureGatewayProfile
description: NSG template set - Create an Infrastructure Gateway Profile
template-version: 1.0
software-type: Nuage Networks VSD
software-version: 5.1.1
variables:
  - name: infrastructure_gateway_profile_name
    type: string
  - name: description
    type: string
    optional: true
  - name: proxy_dns_fqdn
    type: string
  - name: upgrade_policy
    type: choice
    choices: ["DOWNLOAD_AND_UPGRADE_AT_WINDOW", "DOWNLOAD_AND_UPGRADE_NOW", "DOWNLOAD_ONLY", "NONE", "UPGRADE_AT_BOOTSTRAPPING", "UPGRADE_NOW"]
    optional: true
  - name: upgrade_metadata_url
    type: string
    optional: true
  - name: system_sync_time
    type: string
    optional: true
  - name: remote_logging_mode
    type: choice
    choices: ["DISABLED", "RSYSLOG"]
    optional: true
  - name: remote_log_server_address
    type: string
    optional: true
  - name: remote_log_server_port
    type: integer
    optional: true
  - name: ntp_server_key_id
    type: integer
    optional: true
  - name: ntp_server_key
    type: string
    optional: true
  - name: use_two_factor_authentication
    type: string
    optional: true

actions:
  - create-object:
      type: InfrastructureGatewayProfile
      actions:
        - set-values:
            name: {{ infrastructure_gateway_profile_name }}
            description: {{ description | default("Infrastructure Gateway Profile " + infrastructure_gateway_profile_name | default("")) }}
            proxyDNSName: {{ proxy_dns_fqdn }}
            upgradeAction: {{ upgrade_policy | default("NONE") | upper }}
            {% if upgrade_policy | default("NONE") | upper != "NONE" %}
            metadataUpgradePath: {{ upgrade_metadata_url }}
            {% endif %}
            {% if system_sync_time is defined %}
            systemSyncScheduler: {{ system_sync_time }}
            {% endif %}
            remoteLogMode: {{ remote_logging_mode | default("DISABLED") | upper }}
            {% if remote_logging_mode | default("DISABLED") | upper == "RSYSLOG" %}
            remoteLogServerAddress: {{ remote_log_server_address }}
            remoteLogServerPort: {{ remote_log_server_port }}
            {% endif %}
            NTPServerKeyID: {{ ntp_server_key_id | default(0) }}
            {% if ntp_server_key is defined %}
            NTPServerKey: {{ ntp_server_key }}
            {% endif %}
            useTwoFactor: {{ use_two_factor_authentication | default(False) }}

name: Bridge Port
description: First template set - Create an vport for bridge interface
template-version: 1.0
software-type: Nuage Networks VSD
software-version: 5.2.2
variables:
  - name: domain_name
    type: reference
  - name: zone_name
    type: reference
  - name: subnet_name
    type: reference
  - name: gateway_name
    type: reference
  - name: port_name
    type: reference
  - name: access_vlan_number
    type: integer 
  - name: vport_name
    type: string
  - name: description
    type: string
    optional: true
  - name: dpi
    type: choice
    choices: 
      - disabled
      - enabled
      - inherited
    optional: True
  - name: address_spoofing
    type: choice
    choices:
      - disabled
      - enabled
      - inherited
    optional: True
  - name: multicast
    type: choice
    choices:
      - disabled
      - enabled
      - inherited
    optional: True  
  - name: has_attached_interfaces
    type: boolean 
    optional: True
    
actions:
  - select-object:
      type: gateway
      by-field: name
      value: {{ gateway_name }}
      actions:
        - select-object:
            type: port
            by-field: name
            value: {{ port_name }}
            actions:
              - select-object:
                  type: vlan
                  by-field: value
                  value: {{ access_vlan_number }}
                  actions:
                    - store-value:
                        as-name: vlanid
                        from-field: id
  - select-object:
      type: domain
      by-field: name
      value: {{ domain_name }}
      actions:
        - select-object:
            type: zone
            by-field: name
            value: {{ zone_name }}
            actions:
              - select-object:
                  type: subnet
                  by-field: name
                  value: {{ subnet_name }}
                  actions:
                    - create-object:
                        type: vport
                        actions: 
                          - set-values:
                              name: {{ vport_name }}
                              DPI: {{ dpi | default("inherited") | upper }}
                              addressSpoofing: {{ address_spoofing | default("enabled") | upper }}
                              hasAttachedInterfaces: {{ has_attached_interfaces | default(True) }}
                              type: BRIDGE
                              multicast: {{ multicast | default("INHERITED") | upper }}
                              description: {{ description | default("") }}
                          - retrieve-value:
                              from-name: vlanid
                              to-field: VLANID  
                          - create-object:
                              type: bridgeinterface
                              actions:
                                - set-values:
                                    name: {% set concat = "interface-" + vport_name |string %}{{ concat }} 
